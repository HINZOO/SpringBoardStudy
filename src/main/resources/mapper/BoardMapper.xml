<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.acorn.springboardstudy.mapper.BoardMapper">
    <resultMap id="BoardMap" type="boardDto"><!--ÌååÎùºÎØ∏ÌÑ∞Ïùò Í∞íÏù¥ Îã¨ÎùºÏÑú null Í∞íÏù¥ Ï∂úÎ†•ÎêòÏßÄ ÏïäÎèÑÎ°ù ÏÑ§Ï†ï-->
        <id column="b_id" property="bId"/>
        <result column="content" property="content"/>
        <result column="title" property="title"/>
        <result column="u_id" property="uId"/>
        <result column="post_time" property="postTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="status" property="status"/>
        <result column="view_count" property="viewCount"/>
        <association property="likes"
                     select="com.acorn.springboardstudy.mapper.BoardLikeMapper.countStatusByBId"
                     column="b_id"
                     fetchType="lazy"
        />
        <association property="user"
                    select="com.acorn.springboardstudy.mapper.UserMapper.findByUId"
                     column="u_id"
                     fetchType="lazy"
                    />
        <collection property="replies"
                    select="com.acorn.springboardstudy.mapper.BoardReplyMapper.findByBIdAndParentBrIdIsNull"
                    column="b_id"
                    fetchType="lazy"/>
        <collection property="imgs"
                    select="com.acorn.springboardstudy.mapper.BoardImgMapper.findByBId"
                    column="b_id"
                    fetchType="lazy"/>
       <!--üçí Î≥µÌï©Í¥ÄÍ≥Ñ ÎßµÌïë 1:N join ÏùÑ ÌñàÏùÑ Îïå
        <collection property="imges" ofType="BoardImgDto">
            <id property="biId" column="bi_id"/>
            <result property="bId" column="b_id"/>
            <result property="imgPath" column="img_path"/>
        </collection>
       -->

        <!--
        DTOÏóê Î≥ÄÏàòÏÉùÏÑ±(ÌîÑÎ°úÌçºÌã∞Í∞íÍ≥º Í∞ôÏïÑÏïºÌï®)ÌõÑ Îì±Î°ù. select Îäî Ï°∞Ïù∏Ìï† Ìï®ÏàòÏùò Ï£ºÏÜå ÏûÖÎ†•
        repliesÍ∞Ä select Îê†Îïå findByBIdAndParentBrIdIsNull Í∞Ä Ï°∞ÌöåÎêòÍ≥† Í∑∏ Í∞íÏù¥ BoardDto.replies Ïóê Îì§Ïñ¥Í∞ÑÎã§.
        column(DB ÏπºÎüºÎ™Ö)ÏúºÎ°ú ÏÑ†Ïñ∏Îêú b_idÎ•º Í∞ÄÏßÄÍ≥† ÌïòÏúÑ ÎåìÍ∏Ä Î¶¨Ïä§Ìä∏Î•º Í∞ÄÏ†∏Ïò®Îã§.
        fetchType="lazy" Ïù¥Î©¥ Ìò∏Ï∂úÌï† ÎïåÎßå(Ìò∏Ï∂úÏù¥ Ï°¥Ïû¨ÌïòÎäîÏßÄ Í≤ÄÏÉâ ÌõÑ) Ìò∏Ï∂úÏù¥ ÏûàÏúºÎ©¥ Ìï¥Îãπ Ï†ïÎ≥¥Î•º Ï°∞Ìöå(ÏßÄÏó∞Î°úÎî©)
        cf)fetchType="eager"Ïù∏ Í≤ΩÏö∞ Ìò∏Ï∂úÏóÜÏù¥ Î∞îÎ°ú Ï°∞Ìöå.(Ï¶âÏãúÏ°∞Ìöå)
        ex)Î¶¨Ïä§Ìä∏ÏóêÏÑú ÎåìÍ∏ÄÏù¥ ÌïÑÏöîÏóÜÏúºÎ©¥ Ï°∞ÌöåÌïòÏßÄ ÏïäÎäîÎã§.
        JOIN ÎåÄÏã†Ïóê eager ÎÇò lazy Î•º Ïù¥Ïö©ÌïòÏó¨ ÏÑ†ÌÉùÏ†ÅÏúºÎ°ú ÏÇ¨Ïö©.
        -->
    </resultMap>
    <!--
    üìÅ JOIN
    resultMap.collection  : 1:N ÎòêÎäî N:N Í¥ÄÍ≥Ñ(Î¶¨Ïä§Ìä∏)Ïùº Îïå Ï°∞ÌöåÌïòÎäî Î∞©Î≤ï
    resultMap.association  : N:1 ÎòêÎäî 1:1 Í¥ÄÍ≥ÑÏùº Îïå Ï°∞ÌöåÌïòÎäî Î∞©Î≤ï
    select="namespace.id" : resultMap ÏúºÎ°ú Ï°∞ÌöåÌï† Îïå Ìï¥Îãπ ÌïÑÎìúÎ°ú Îã§Î•∏ ÎÇ¥Ïó≠ÏùÑ Ï°∞ÌöåÌï¥ÏÑú ÌååÏã±
    column="b_id" : Ï°∞ÌöåÌï† Îïå ÏÇ¨Ïö©Ìï† ÌååÎùºÎØ∏ÌÑ∞Ïùò Í∞í
    fetchType="lazy"  ÏßÄÏó∞Î°úÎî©(Ìò∏Ï∂úÏù¥ÏûàÎäîÏßÄ Í≤ÄÏÉâ ÌõÑ ÏûàÏúºÎ©¥ Ï°∞Ìöå)Î¶¨Ïä§Ìä∏ÏóêÏÑú ÎåìÍ∏ÄÌïÑÏöîÏóÜÏúºÎ©¥ Ï°∞ÌöåÌïòÏßÄÏïäÏùå
    fetchType="eager" Ï¶âÏãúÏ°∞Ìöå Ìò∏Ï∂úÏóÜÏñ¥ÎèÑ join
     -->
    <!--
    SELECT  LAST_INSERT_ID : autoincrement Î°ú Î∞©Í∏à ÏÉùÏÑ±Îêú bid
    useGeneratedKeys="true" : autoincrement Î°ú pkÎ•º ÏÉùÏÑ±ÌïúÎã§.
    keyProperty="bId" : ÌååÎùºÎØ∏ÌÑ∞Î°ú ÎÑòÏñ¥Ïò® BoardDto Ïùò bId Î•º autoincrement Î°ú ÏÉùÏÑ±Îêú ÌÇ§Î•º Î∞òÌôòÌïòÍ≤†Îã§.
    =>ÎßàÏßÄÎßâÏúºÎ°ú ÏÉùÏÑ±Îêú ÌååÎùºÎØ∏ÌÑ∞Ïùò Í∞íÏùÑ bIdÏóê ÎÑ£Í≤†Îã§.
    https://mybatis.org/mybatis-3/ko/sqlmap-xml.html
    -->
    <insert useGeneratedKeys="true" keyProperty="bId" id="insertOne" parameterType="boardDto">
        INSERT INTO boards (u_id, title, content) VALUE (#{uId},#{title},#{content})
    </insert>
    <update id="updateOne"  parameterType="boardDto">
        UPDATE boards SET title=#{title},content=#{content} WHERE b_id=#{bId}
    </update>
    <update id="updateStatusByBId"  parameterType="boardDto">
        UPDATE boards SET status=#{status} WHERE b_id=#{bId}
    </update>
    <update id="updateIncrementViewCountByBId" >
        UPDATE boards SET view_count=(view_count+1) WHERE b_id=#{bId}
    </update>

    <delete id="deleteOne" >/* parameterType ÏÉùÎûµ Í∞ÄÎä•*/
        DELETE FROM boards WHERE b_id=#{bId}
    </delete>
    <select id="findAll" resultMap="BoardMap">
        SELECT * FROM boards
    </select>
    <!--[Î≥µÌï©Í¥ÄÍ≥Ñ ÎßµÌïëÌï†Îïå sql]
    <select id="findAll" resultMap="BoardMap">
        SELECT * FROM boards b LEFT JOIN board_imgs i USING (b_id);
    </select>
    -->
    <select id="findByBId" resultMap="BoardMap">
        SELECT * FROM boards WHERE b_id=#{bId}
    </select>
</mapper>